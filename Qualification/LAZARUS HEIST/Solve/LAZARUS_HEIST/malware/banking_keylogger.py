#!/usr/bin/env python3
import socket
import time
import hashlib
import base64
import os
import json
from datetime import datetime

class LazarusBankingKeylogger:
    def __init__(self):
        self.keylog_buffer = []
        self.credentials_harvested = []
        self.swift_transactions = []
        self.c2_servers = ["172.20.1.200", "update.microsoft-security.org"]
        self.session_id = hashlib.md5(os.urandom(16)).hexdigest()[:16]
        self.encryption_key = b'L4z4ru5Gr0up2024K3y'
        
    def log_keystroke(self, window_title, keystroke, timestamp=None):
        if not timestamp:
            timestamp = datetime.now().isoformat()
            
        entry = {
            "timestamp": timestamp,
            "window": window_title,
            "keystroke": keystroke,
            "session_id": self.session_id,
            "hostname": "BANK-WORKSTATION-01"
        }
        
        self.keylog_buffer.append(entry)
    
    def harvest_banking_credentials(self):
        banking_credentials = [
            {
                "system": "SWIFT_TERMINAL",
                "username": "swift_operator", 
                "password": "Sw1ft$ecur3!",
                "password_hash": "7d865e959b2466918c9863afca942d0fb89d7c9ac0c99bafc3749504ded97730",
                "access_level": "OPERATOR",
                "last_login": "2024-01-15 09:15:23"
            },
            {
                "system": "CORE_BANKING_DATABASE",
                "username": "db_admin",
                "password": "B4nkDB_2024!",
                "password_hash": "e99a18c428cb38d5f260853678922e03ab37f4a9bc06456b2a30e91b8e2e8e8e",
                "access_level": "DBA_ADMIN", 
                "last_login": "2024-01-14 16:42:11"
            },
            {
                "system": "PAYMENT_GATEWAY",
                "username": "payment_admin",
                "password": "P4ym3nt$G4t3w4y2024",
                "password_hash": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456",
                "access_level": "GATEWAY_ADMIN",
                "last_login": "2024-01-15 11:28:07"
            },
            {
                "system": "SWIFT_AUTHENTICATION_SERVER", 
                "username": "swift_auth_svc",
                "password": "Sw1ftAuth$erv1ce2024!",
                "password_hash": "9f8e7d6c5b4a3928170e5d4c3b2a19087f6e5d4c3b2a1098765432109876543",
                "access_level": "SERVICE_ACCOUNT",
                "last_login": "2024-01-15 14:15:30"
            }
        ]
        
        self.credentials_harvested.extend(banking_credentials)
        return banking_credentials
    
    def capture_swift_messages(self):
        swift_messages = [
            {
                "message_type": "MT103", 
                "transaction_reference": "TXN20240115001",
                "sender_bic": "FIRSTBANKKW",
                "receiver_bic": "LAZABANKPYXX",
                "beneficiary_name": "LAZARUS FRONT COMPANY LIMITED",
                "beneficiary_account": "KP1234567890123456789012",
                "amount": "81000000.00",
                "currency": "USD",
                "value_date": "2024-01-15",
                "purpose": "INVESTMENT_TRANSFER",
                "captured_timestamp": datetime.now().isoformat()
            },
            {
                "message_type": "MT202",
                "transaction_reference": "TXN20240115002", 
                "sender_bic": "FIRSTBANKKW",
                "receiver_bic": "KORDEVBKSEOUL",
                "beneficiary_name": "KOREA DEVELOPMENT BANK",
                "beneficiary_account": "KR1234567890123456789012", 
                "amount": "15000000.00",
                "currency": "USD",
                "value_date": "2024-01-15",
                "purpose": "TRADE_FINANCE_FACILITY",
                "captured_timestamp": datetime.now().isoformat()
            }
        ]
        
        self.swift_transactions.extend(swift_messages)
        return swift_messages
    
    def xor_encrypt(self, data, key):
        result = bytearray()
        for i in range(len(data)):
            result.append(data[i] ^ key[i % len(key)])
        return bytes(result)
    
    def exfiltrate_all_data(self):
        complete_intelligence = {
            "operation": "LAZARUS_SWIFT_HEIST_FINAL_EXFIL",
            "session_id": self.session_id,
            "target_details": {
                "hostname": "BANK-WORKSTATION-01",
                "user": "swift_operator", 
                "domain": "FIRSTBANK.CORP",
                "ip_address": "172.30.1.100"
            },
            "collected_keystrokes": self.keylog_buffer,
            "harvested_credentials": self.credentials_harvested,
            "captured_swift_transactions": self.swift_transactions,
            "system_intelligence": {
                "installed_banking_software": [
                    "SWIFT Alliance Access v7.5.2",
                    "Core Banking System v12.4.1", 
                    "Payment Gateway Interface v8.2.3"
                ]
            },
            "exfiltration_timestamp": datetime.now().isoformat(),
            "total_value_targeted": "96000000.00 USD"
        }
        
        return complete_intelligence
    
    def simulate_banking_activity(self):
        banking_windows = [
            "SWIFT Alliance Access - Message Input",
            "Core Banking System - Transaction Processing", 
            "Treasury Management - Wire Transfer"
        ]
        
        swift_keystrokes = [
            "swift_operator", "Tab", "Sw1ft$ecur3!", "Enter",
            "NEW_TRANSFER", "Tab", "MT103", "Tab", 
            "SENDER:", "Space", "FIRSTBANKKW", "Tab",
            "RECEIVER:", "Space", "LAZABANKPYXX", "Tab", 
            "AMOUNT:", "Space", "81000000.00", "Tab",
            "CURRENCY:", "Space", "USD", "Tab",
            "BENEFICIARY:", "Space", "LAZARUS", "Space", "FRONT", "Space", "COMPANY", "Tab",
            "AUTHORIZE_TRANSFER", "Enter"
        ]
        
        for i, keystroke in enumerate(swift_keystrokes):
            window = banking_windows[i % len(banking_windows)]
            self.log_keystroke(window, keystroke)
        
        self.harvest_banking_credentials()
        self.capture_swift_messages()
        return self.exfiltrate_all_data()

if __name__ == "__main__":
    keylogger = LazarusBankingKeylogger()
    keylogger.simulate_banking_activity()
